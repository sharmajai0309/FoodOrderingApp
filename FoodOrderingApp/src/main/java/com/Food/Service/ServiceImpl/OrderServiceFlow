
To Create order

┌─────────────────────────────────────────────────────────────────────┐
│                       ORDER CREATION FLOW                           │
│    [Frontend/UI] → [Backend/Controller] → [Service] → [Database]    │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                        STEP 1: USER AUTHENTICATION                  │
└─────────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────────┐
│  User clicks "PLACE ORDER" button on UI                            │
│  ↓                                                                  │
│  Request with order data sent to backend                           │
│  ↓                                                                  │
│  Controller: @PostMapping("/api/orders")                           │
│  ↓                                                                  │
│  Service Method: createOrder() is called                           │
└─────────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────────┐
│                        STEP 2: GET CURRENT USER                     │
└─────────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────────┐
│  Authentication Token → Decode → Get User ID → Fetch User from DB  │
│                                                                    │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐           │
│  │   TOKEN     │ →  │   JWT UTIL  │ →  │  USER ID    │ →         │
│  └─────────────┘    └─────────────┘    └─────────────┘           │
│                                                                   │
│                                 ┌─────────────────┐               │
│                                 │  DATABASE       │               │
│                                 │  ┌──────────┐   │               │
│                                 │  │  USER    │ ←─┘               │
│                                 │  │  TABLE   │                   │
│                                 │  └──────────┘                   │
│                                 └─────────────────┘               │
└─────────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────────┐
│                        STEP 3: ADDRESS HANDLING                     │
└─────────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────────┐
│  ┌────────────────────┐                                             │
│  │  Address from UI   │                                             │
│  │  - Street: ...     │                                             │
│  │  - City: ...       │                                             │
│  │  - Zip: ...        │                                             │
│  └─────────┬──────────┘                                             │
│            ↓ SAVE                                                    │
│  ┌────────────────────┐                                             │
│  │  Address Table     │ ←─── AddressRepository.save()              │
│  │  (saved to DB)     │                                             │
│  └─────────┬──────────┘                                             │
│            ↓ CHECK                                                   │
│  ┌─────────────────────────────────────────────────┐                │
│  │  If user doesn't have this address in list:     │                │
│  │  ┌─────────────────┐        ┌─────────────────┐ │                │
│  │  │   USER          │        │   ADDRESS       │ │                │
│  │  │   Addresses:    │ -----> │   ID: 123       │ │                │
│  │  │   [Address1]    │        │   Street: ...   │ │                │
│  │  │   [Address2]    │        └─────────────────┘ │                │
│  │  └─────────────────┘                            │                │
│  └─────────────────────────────────────────────────┘                │
└─────────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────────┐
│                        STEP 4: GET RESTAURANT                       │
└─────────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────────┐
│  ┌───────────────┐                                                   │
│  │ Restaurant ID │ → RestaurantService.findById() →                 │
│  └───────┬───────┘                                                   │
│          ↓                                                           │
│  ┌───────────────┐    ┌─────────────────┐                           │
│  │  RESTAURANT   │ ←─ │  DATABASE       │                           │
│  │  - Name       │    │  ┌──────────┐   │                           │
│  │  - Location   │    │  │RESTAURANT│   │                           │
│  │  - Cuisine    │    │  │  TABLE   │   │                           │
│  └───────────────┘    │  └──────────┘   │                           │
│                       └─────────────────┘                           │
└─────────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────────┐
│                        STEP 5: CREATE ORDER OBJECT                  │
└─────────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────┐                │
│  │               ORDER OBJECT                      │                │
│  │  ┌──────────────────────────────────────────┐   │                │
│  │  │  Fields being set:                       │   │                │
│  │  │  - customer: User                        │   │                │
│  │  │  - restaurant: Restaurant                │   │                │
│  │  │  - deliveryAddress: Address              │   │                │
│  │  │  - createdAt: Current Time               │   │                │
│  │  │  - orderStatus: "PENDING"                │   │                │
│  │  │  - items: (Empty for now)                │   │                │
│  │  └──────────────────────────────────────────┘   │                │
│  └─────────────────────────────────────────────────┘                │
└─────────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────────┐
│                        STEP 6: GET CART & ITEMS                     │
└─────────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────┐                │
│  │  User ID → CartService.getCartByCustomer()     │                │
│  │                                                 │                │
│  │  ┌──────────────┐                              │                │
│  │  │    CART      │                              │                │
│  │  │  ┌────────┐  │                              │                │
│  │  │  │ ITEM 1 │  │                              │                │
│  │  │  │ - Food │  │    For Each Cart Item:       │                │
│  │  │  │ - Qty  │  │    ┌─────────────────────┐   │                │
│  │  │  │ - Price│  │    │ Create OrderItem    │   │                │
│  │  │  └────────┘  │    │ Copy: Food, Qty,    │   │                │
│  │  │  ┌────────┐  │    │ Price, Ingredients  │   │                │
│  │  │  │ ITEM 2 │  │    │ Save to Database    │   │                │
│  │  │  │ - Food │  │    └─────────────────────┘   │                │
│  │  │  │ - Qty  │  │                              │                │
│  │  │  │ - Price│  │                              │                │
│  │  │  └────────┘  │                              │                │
│  │  └──────────────┘                              │                │
│  └─────────────────────────────────────────────────┘                │
└─────────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────────┐
│                        STEP 7: SAVE ORDER                          │
└─────────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────┐                │
│  │  Now Order has:                                │                │
│  │  - All items from cart                         │                │
│  │  - Total price from cart                       │                │
│  │  - Item count                                  │                │
│  │                                                 │                │
│  │  ┌─────────────────┐                           │                │
│  │  │  Order Table    │ ←─── orderRepository.save()               │
│  │  │  (saved to DB)  │                           │                │
│  │  └─────────────────┘                           │                │
│  │                                                 │                │
│  │  ┌─────────────────┐                           │                │
│  │  │  Restaurant     │ ←── Add order to restaurant's order list  │
│  │  │  Orders List    │                           │                │
│  │  └─────────────────┘                           │                │
│  └─────────────────────────────────────────────────┘                │
└─────────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────────┐
│                        STEP 8: CLEAR CART                          │
└─────────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────┐                │
│  │  User ID → CartService.clearCart()             │                │
│  │                                                 │                │
│  │  ┌──────────────┐                              │                │
│  │  │    CART      │                              │                │
│  │  │  ┌────────┐  │                              │                │
│  │  │  │ ITEM 1 │  │    DELETE ALL ITEMS          │                │
│  │  │  │ - Food │  │    ┌─────────────────────┐   │                │
│  │  │  │ - Qty  │  │    │   EMPTY CART        │   │                │
│  │  │  │ - Price│  │    │                     │   │                │
│  │  │  └────────┘  │    └─────────────────────┘   │                │
│  │  │              │                              │                │
│  │  └──────────────┘                              │                │
│  └─────────────────────────────────────────────────┘                │
└─────────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────────┐
│                        STEP 9: RETURN RESPONSE                      │
└─────────────────────────────────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────┐                │
│  │  Create Response Object:                        │                │
│  │  - orderId                                      │                │
│  │  - status: "PENDING"                           │                │
│  │  - totalAmount                                  │                │
│  │  - message: "Order placed successfully!"       │                │
│  │                                                 │                │
│  │  ┌──────────────┐    ┌─────────────────┐       │                │
│  │  │  BACKEND     │ →  │     FRONTEND    │       │                │
│  │  │  RESPONSE    │    │  (UI/App)       │       │                │
│  │  └──────────────┘    └─────────────────┘       │                │
│  │                      ↓                          │                │
│  │                 Show Success                    │                │
│  │                 Message to User                 │                │
│  └─────────────────────────────────────────────────┘                │
└─────────────────────────────────────────────────────────────────────┘




┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   UI/User   │ →  │  Controller │ →  │   Service   │ →  │  Database   │
│   Clicks    │    │ /api/orders │    │ createOrder │    │   SAVE      │
│   "Order"   │    │   (POST)    │    │   Method    │    │   DATA      │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       ↓                  ↓                  ↓                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│   1. Auth User → 2. Save Address → 3. Get Restaurant →             │
│                                                                     │
│   4. Create Order → 5. Get Cart Items → 6. Create Order Items →    │
│                                                                     │
│   7. Save Order → 8. Clear Cart → 9. Return Response → 10. UI      │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘